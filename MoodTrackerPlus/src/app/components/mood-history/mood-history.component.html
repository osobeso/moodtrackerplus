<div class="history-container">
<header class="header">
  <button class="back-button" (click)="goBack()" aria-label="Go back to mood selector">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    <span>Back</span>
  </button>
  <h1>Mood History</h1>
  @if (moodEntries.length > 0) {
    <button class="clear-button" (click)="clearAll()" aria-label="Clear all mood entries">Clear All</button>
  }
</header>

  @if (moodEntries.length === 0) {
    <div class="empty-state" role="status">
      <div class="empty-icon" aria-hidden="true">ðŸ“Š</div>
      <h2>No mood entries yet</h2>
      <p>Start tracking your mood to see your history here</p>
      <button class="add-mood-button" (click)="goBack()">Add Your First Mood</button>
    </div>
  } @else {
    <main>
      @if (weatherCorrelations.length > 0) {
        <section class="correlations-section">
          <button class="toggle-correlations-button" (click)="toggleCorrelations()" aria-label="Toggle weather-mood correlations">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
              <path d="M3 3v18h18"></path>
              <path d="M18 17V9"></path>
              <path d="M13 17V5"></path>
              <path d="M8 17v-3"></path>
            </svg>
            <span>{{ showCorrelations ? 'Hide' : 'Show' }} Weather-Mood Patterns</span>
          </button>
          
          @if (showCorrelations) {
            <div class="correlations-grid">
              @for (correlation of weatherCorrelations; track correlation.weatherCondition) {
                <article class="correlation-card">
                  <div class="correlation-header">
                    <span class="correlation-icon" aria-hidden="true">{{ correlation.weatherIcon }}</span>
                    <h3 class="correlation-title">{{ correlation.weatherCondition }}</h3>
                    <span class="correlation-count">{{ correlation.totalCount }} entries</span>
                  </div>
                  <div class="mood-distribution">
                    @for (moodData of correlation.moodCounts; track moodData.mood) {
                      <div class="mood-bar-container">
                        <div class="mood-bar-label">
                          <span class="mood-bar-emoji">{{ moodData.emoji }}</span>
                          <span class="mood-bar-name">{{ moodData.mood }}</span>
                        </div>
                        <div class="mood-bar-wrapper">
                          <div class="mood-bar" [style.width.%]="(moodData.count / correlation.totalCount) * 100">
                            <span class="mood-bar-count">{{ moodData.count }}</span>
                          </div>
                        </div>
                      </div>
                    }
                  </div>
                </article>
              }
            </div>
          }
        </section>
      }
      
      <section class="entries-list" aria-label="Mood entry list">
        @for (entry of moodEntries; track entry.id) {
          <article class="entry-card">
            <div class="entry-emoji" aria-hidden="true">{{ entry.emoji }}</div>
            <div class="entry-details">
              <h3 class="entry-mood">{{ entry.mood }}</h3>
              <p class="entry-time">{{ getRelativeTime(entry.timestamp) }}</p>
              <p class="entry-date">
                <time [attr.datetime]="entry.timestamp">
                  {{ formatDate(entry.timestamp) }} at {{ formatTime(entry.timestamp) }}
                </time>
              </p>
              @if (entry.weather) {
                <div class="weather-info">
                  <span class="weather-icon" aria-hidden="true">{{ entry.weather.icon }}</span>
                  <span class="weather-temp">{{ entry.weather.temperature }}Â°F</span>
                  <span class="weather-condition">{{ entry.weather.condition }}</span>
                </div>
              }
            </div>
            <button class="delete-button" (click)="deleteEntry(entry.id)" [attr.aria-label]="'Delete ' + entry.mood + ' mood entry from ' + formatDate(entry.timestamp)">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              <span class="visually-hidden">Delete</span>
            </button>
          </article>
        }
      </section>

      <footer class="stats" role="contentinfo">
        <p class="total-entries" aria-live="polite">Total entries: {{ moodEntries.length }}</p>
      </footer>
    </main>
  }
</div>
