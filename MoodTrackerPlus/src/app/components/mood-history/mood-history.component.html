<!-- Mood History Container -->
<div class="history-container">
<!-- Header with navigation and view toggle -->
<header class="header">
  <button class="back-button" (click)="goBack()" aria-label="Go back to mood selector">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    <span>Back</span>
  </button>
  <h1>Mood History</h1>
  @if (moodEntries.length > 0) {
    <button class="clear-button" (click)="clearAll()" aria-label="Clear all mood entries">Clear All</button>
  }
</header>

<!-- View toggle buttons -->
@if (moodEntries.length > 0) {
  <div class="view-toggle" role="group" aria-label="View mode selection">
    <button 
      class="toggle-button" 
      [class.active]="viewMode === 'calendar'" 
      (click)="toggleView('calendar')"
      aria-label="Calendar view"
      [attr.aria-pressed]="viewMode === 'calendar'">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      <span>Calendar</span>
    </button>
    <button 
      class="toggle-button" 
      [class.active]="viewMode === 'list'" 
      (click)="toggleView('list')"
      aria-label="List view"
      [attr.aria-pressed]="viewMode === 'list'">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
        <line x1="8" y1="6" x2="21" y2="6"></line>
        <line x1="8" y1="12" x2="21" y2="12"></line>
        <line x1="8" y1="18" x2="21" y2="18"></line>
        <line x1="3" y1="6" x2="3.01" y2="6"></line>
        <line x1="3" y1="12" x2="3.01" y2="12"></line>
        <line x1="3" y1="18" x2="3.01" y2="18"></line>
      </svg>
      <span>List</span>
    </button>
  </div>
}

  @if (moodEntries.length === 0) {
    <div class="empty-state" role="status">
      <div class="empty-icon" aria-hidden="true">ðŸ“Š</div>
      <h2>No mood entries yet</h2>
      <p>Start tracking your mood to see your history here</p>
      <button class="add-mood-button" (click)="goBack()">Add Your First Mood</button>
    </div>
  } @else if (viewMode === 'calendar') {
    <!-- Calendar View -->
    <main>
      <div class="calendar-navigation">
        <button class="nav-button" (click)="previousMonth()" aria-label="Previous month">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <h2 class="calendar-month">{{ getMonthYearString() }}</h2>
        <button class="nav-button" (click)="nextMonth()" aria-label="Next month">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>

      <!-- Calendar Grid -->
      <div class="calendar-grid" role="grid" aria-label="Mood calendar">
        <!-- Day headers -->
        <div class="day-header" role="row">
          <div class="day-name" role="columnheader">Sun</div>
          <div class="day-name" role="columnheader">Mon</div>
          <div class="day-name" role="columnheader">Tue</div>
          <div class="day-name" role="columnheader">Wed</div>
          <div class="day-name" role="columnheader">Thu</div>
          <div class="day-name" role="columnheader">Fri</div>
          <div class="day-name" role="columnheader">Sat</div>
        </div>

        <!-- Calendar days -->
        @for (day of calendarDays; track day.date.getTime()) {
          <div 
            class="calendar-day" 
            [class.other-month]="!day.isCurrentMonth"
            [class.today]="isToday(day.date)"
            [class.has-entries]="day.entries.length > 0"
            role="gridcell"
            [attr.aria-label]="day.date.toLocaleDateString() + (day.entries.length > 0 ? ', ' + day.entries.length + ' mood entries' : '')">
            <div class="day-number">{{ day.date.getDate() }}</div>
            @if (day.entries.length > 0) {
              <div class="day-moods" aria-hidden="true">
                @for (entry of day.entries; track entry.id) {
                  <span class="mood-emoji" [title]="entry.mood + ' at ' + formatTime(entry.timestamp)">{{ entry.emoji }}</span>
                }
              </div>
            }
          </div>
        }
      </div>

      <!-- Calendar footer stats -->
      <footer class="stats" role="contentinfo">
        <p class="total-entries" aria-live="polite">Total entries: {{ moodEntries.length }}</p>
      </footer>
    </main>
  } @else {
    <main>
      <section class="entries-list" aria-label="Mood entry list">
        @for (entry of moodEntries; track entry.id) {
          <article class="entry-card">
            <div class="entry-emoji" aria-hidden="true">{{ entry.emoji }}</div>
            <div class="entry-details">
              <h3 class="entry-mood">{{ entry.mood }}</h3>
              <p class="entry-time">{{ getRelativeTime(entry.timestamp) }}</p>
              <p class="entry-date">
                <time [attr.datetime]="entry.timestamp">
                  {{ formatDate(entry.timestamp) }} at {{ formatTime(entry.timestamp) }}
                </time>
              </p>
            </div>
            <button class="delete-button" (click)="deleteEntry(entry.id)" [attr.aria-label]="'Delete ' + entry.mood + ' mood entry from ' + formatDate(entry.timestamp)">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
              <span class="visually-hidden">Delete</span>
            </button>
          </article>
        }
      </section>

      <footer class="stats" role="contentinfo">
        <p class="total-entries" aria-live="polite">Total entries: {{ moodEntries.length }}</p>
      </footer>
    </main>
  }
</div>
